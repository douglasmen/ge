<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:plcf="http://www.powerlogic.com.br/plcf"
	xmlns:plct="http://www.powerlogic.com.br/plct"
	xmlns:tr="http://myfaces.apache.org/trinidad"
	xmlns:trh="http://myfaces.apache.org/trinidad/html">
	
	Realiza a renderizacao de formulario tipo Mestre-Detalhe em ergonomia de "caixas verticais" (Vertical Box ou VBox), onde
	cada seção do formulário é ordenada uma abaixo da outra, de acordo com uma numeração.
	
	<ui:composition template="/fcls/template/PlcGeralTemplate.xhtml">
		<ui:define name="plc-corpo-formulario">
	 		
	 		<script type="text/javascript">
				
	 			function retraiExpande (componente, detalhe){
					if (jQuery(componente).hasClass('iMinimizar')){
						jQuery(componente).removeClass('iMinimizar').addClass('iMaximizar');
						jQuery('#' + detalhe + ' > fieldset > *').not('legend').hide();
						jQuery('button[id=corpo:formulario:novoComponente' + detalhe + ']').hide();
					} else {
						jQuery(componente).removeClass('iMaximizar').addClass('iMinimizar');
						jQuery('#' + detalhe + ' > fieldset > *').not('legend').show();
						jQuery('button[id=corpo:formulario:novoComponente' + detalhe + ']').show();
					}
		 		}
				
				function recuperaPorDemanda (){
					setTecnologia("Facelets");
					plcGeral.formSubmit('${requestScope.pStrutsAction}','#{msg["jcompany.evt.recupera.por.demanda"]}');		
				}
				
	 		</script>
	 		
		 	<div id="container">
		 		<c:set var="sufixo" value="Mdt"/>
				<c:if test="#{requestScope.logicaPlc=='subdetalhe'}">
					<c:set var="sufixo" value="Mds"/>
				</c:if>
				<c:if test="#{requestScope.logicaPlc=='mandetalhe'}">
					<c:set var="sufixo" value="Mad"/>
					<c:if test="#{requestScope.nomeSubdetalhe != null and requestScope.nomeSubdetalhe != ''}">
						<c:set var="sufixo" value="Mas"/>
					</c:if>
				</c:if>
				<c:if test="#{plcConfigUrlColaboracao.exibeAba(0)}">
					<div id="#{plcAliasPrefixoAction}Mestre">
						<ui:include src="#{requestScope.dirBaseFacelets}/#{plcAliasPrefixoAction}#{sufixo}.xhtml" />
					</div>
				</c:if>
				<c:forEach begin="1" end="#{plcConfigUrlColaboracao.getNumComponentes()}" varStatus="status">
					<c:if test="#{plcConfigUrlColaboracao.exibeAba(status.index)}">
						<div id="#{plcAliasPrefixoAction}Mestre#{status.index + 1}">
							<ui:include src="#{requestScope.dirBaseFacelets}/#{plcAliasPrefixoAction}#{sufixo}#{status.index + 1}.xhtml" />
						</div>	
					</c:if>	
				</c:forEach>
				<c:forEach begin="1" end="#{plcConfigUrlColaboracao.getNumDetalhes()}" varStatus="status">
					<c:if test="#{plcConfigUrlColaboracao.exibeAba(plcConfigUrlColaboracao.getNumComponentes() + status.index)}">
						<div id="#{plcAliasPrefixoAction}Det#{status.index != 1 ? status.index : ''}">
							<span class="plc-corpo-acao-detalhe-sem-tab">
								<div class="plc-corpo-acao">
										<c:if test="#{empty requestScope.visualizaDocumentoPlc}">
											
												<c:set var="isPorDemanda" value="#{plcControleConversacao.getDetalhesPorDemanda().containsKey(plcConfigUrlColaboracao.getNomeDetalhe(status.index - 1) ) and !('N'.equals(requestScope.naoVerificarDetalheDemanda)) and !('S'.equals(requestScope.plcIndAcaoNovo))}"/>
												
												<span id="portlet#{plcAliasPrefixoAction}Det#{status.index != 1 ? status.index : ''}"
													class="ico iMinimizar" 
													onclick="jQuery('#detCorrPlc').val('#{plcConfigUrlColaboracao.getNomeDetalhe(status.index - 1)}'); retraiExpande (this, '#{plcAliasPrefixoAction}Det#{status.index != 1 ? status.index : ''}'); #{isPorDemanda?'recuperaPorDemanda()':''}"/>
												
												<script type="text/javascript">
												
													jQuery(function(){
														var portlet = jQuery('#portlet#{plcAliasPrefixoAction}Det#{status.index != 1 ? status.index : ''}');
														var legend = jQuery('##{plcAliasPrefixoAction}Det#{status.index != 1 ? status.index : ''} > fieldset > legend');
														legend.prepend (portlet);
														if (#{isPorDemanda}){
															legend.append('...');
															jQuery('##{plcAliasPrefixoAction}Det#{status.index != 1 ? status.index : ''} > fieldset > *').not('legend').hide();
														}
														
													});
												
												</script>
										
											<div class="plc-corpo-acao-generico" id="novoComponente#{plcConfigUrlColaboracao.getNomeDetalhe(status.index - 1)}">
												
												
												<c:set var="botaoDetalhe" value="jcompany_evt_incluir_detalhe_#{plcConfigUrlColaboracao.getNomeDetalhe(status.index - 1)}"/>
												<plcf:botaoAcao acao="novo" label="jcompany.evt.incluir.detalhe" botaoArrayID="NOVO" id="novoComponente#{plcAliasPrefixoAction}Det#{status.index != 1 ? status.index : ''}" idPlc="#{requestScope.id}"
												     partialSubmit="#{requestScope.ajaxUsa}"  urlIcone="ico iNovo"
												     immediate="false" validaForm="false" rendered="#{plcConfigUrlColaboracao.exibeAcao(botaoDetalhe)}" 
												     detalhe="#{plcConfigUrlColaboracao.getNomeDetalhe(status.index - 1)}"/>
												 
												 
											</div>
										</c:if>
								</div>
							</span>
							<plct:paginacaoDetalhe nomeDetalhe="#{plcConfigUrlColaboracao.getNomeDetalhe(status.index - 1)}" />
							
							<ui:include src="#{requestScope.dirBaseFacelets}/#{plcAliasPrefixoAction}Det#{status.index != 1 ? status.index : ''}.xhtml" />
						</div>		
					</c:if>	
				</c:forEach>
			</div>
			
		</ui:define>
	</ui:composition>
	
</html>