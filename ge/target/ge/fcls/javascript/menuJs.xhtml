<script type="text/javascript">
//<![CDATA[
	jQuery(function(){
		function extraiUrlsNegadas(baseUrl, urls) {
			if (urls) {
				var urlsNegadas = urls.split(',');
				for (var i = 0; i < urlsNegadas.length; i++) {
					var url = jQuery.trim(urlsNegadas[i]);
					if (url != '') {
						if (url.charAt(0) != '/') url = '/' + url;
						urlsNegadas[i] = baseUrl + url;
					}
				}
				return urlsNegadas;
			} else {
				return false;
			}
		}
		/*
		 * cria um menu.
		 */
		function aplicaSegurancaMenu(idMenu, urlsNegadas) {
			// Remove os LI que contenham links negados.
			if (urlsNegadas && urlsNegadas.length > 0) {
				jQuery('#' + idMenu).find('li > a').each(function(){
					var a = jQuery(this);
					var href = a.attr('href');
					if (href && href != '#' && jQuery.inArray(href, urlsNegadas) != -1) {
						//remove o LI se for uma URL invalida.
						a.parent().remove();
					}
				});
			}
			// Ajax parcial
			if (#{metadados['parcialAjaxUsa'] == 'S'}) {
				jQuery('#' + idMenu).find('li > a').each(function(){
					var a = jQuery(this);
					var href = a.attr('href');
					if (href && href != '#') {
						a.attr('href', 'javascript: jQuery.plc.parcialAjaxCorpo(\''+href+'\');');
					}
				});
			}
			// Remove os Menus Vazios!
			jQuery('#' + idMenu).find('li > ul').each(function(){
				var ul = jQuery(this);
				if (ul.children('li').length === 0) {
					ul.parent().remove();
				}
			});
		}
		// Busca as URL's Negadas.
		jQuery.ajax({
			url: "#{request.contextPath}/soa/plc/security/urls"
			,cache: false
			,success: function(urls){
				aplicaSegurancaMenu('plc-menu-sistema', extraiUrlsNegadas('#{request.contextPath}', urls));
			}
		});
	});
	/* Cria o Menu Pulldown */
	jQuery(function() {
		jQuery("div.plc-menu-sistema-pulldown li").hover(function(){
			jQuery(this).addClass("ui-state-hover");
			jQuery('ul:first',this).css('visibility', 'visible');
		}, function(){
			jQuery(this).removeClass("ui-state-hover");
			jQuery('ul:first',this).css('visibility', 'hidden');
		}).mouseup(function(){
			jQuery(this).removeClass("ui-state-hover");
			jQuery('ul:first',this).css('visibility', 'hidden');
		});

		if (ExpYes){
			/* erro no internet explorer 7, as abas do mestredetalhe estao sobrepondo o menu */
			jQuery("div.plc-menu-sistema-pulldown > ul").css('z-index', 1000);
		}

		jQuery('div.plc-menu li li').hover(
			function() { jQuery(this).addClass('ui-state-highlight'); },
			function() { jQuery(this).removeClass('ui-state-highlight'); }
		);
	});
//]]>
</script>
