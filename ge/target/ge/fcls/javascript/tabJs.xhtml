<script type="text/javascript"  
				xmlns:ui="http://java.sun.com/jsf/facelets"
				xmlns:tr="http://myfaces.apache.org/trinidad"
				xmlns:plcf="http://www.powerlogic.com.br/plcf"
				xmlns:c="http://java.sun.com/jstl/core">

<c:if test="${not empty requestScope.tabFolderCamposIda || not empty requestScope.tabFolderCamposVolta}">
	<c:if test="${not empty requestScope.stringTabFolderCamposFocoPlc}">
		setTabFolderCamposFoco ("${requestScope.stringTabFolderCamposFocoPlc}");
	</c:if>
</c:if>

setAjaxUsa(#{requestScope.ajaxUsa});

function PlcFormTabs() {

	jQuery('#plc-form-tab').hide();
	
	function applyTabs(tabsToRemove){
		
		if (tabsToRemove) {
			
			jQuery('#plc-form-tab > ul > li > a').each(function(indice, objeto){
				var indiceAtual = indice + 1;
				if (tabsToRemove.indexOf("," + indiceAtual + ",") > -1){
					jQuery(objeto).remove();
				}
			});
			
			jQuery('#plc-form-tab > div').each(function(indice, objeto){
				var indiceAtual = indice + 1;
				if (tabsToRemove.indexOf("," + indiceAtual + ",") > -1){
					jQuery(objeto).remove();
					if (indiceAtual == 1){
						jQuery('#plc-form-tab').tabs(2);
					}
				}
			});
		}
		
		var selectedTab = 0;
		var detCorrPlc = jQuery('#detCorrPlc').val();
		
		jQuery('#plc-form-tab > ul > li > a').each(function(indice, objeto){
		
			var regexDetalhe =  new RegExp ("(\\w+)\\[(\\d+)\\].(\\w+)");
			var valorRegex = regexDetalhe.exec(detCorrPlc)
			if (valorRegex != null)
				detCorrPlc = valorRegex[1];
		
			if (jQuery(objeto).attr('id') == detCorrPlc) {
				selectedTab = indice;
				return false;
			}
		});
		
		jQuery('#plc-form-tab').show().tabs({
			selected: selectedTab
			,select: function(event, ui) {
				var id = jQuery(ui.tab).attr('id');
				if (id != null){
					jQuery('#detCorrPlc').val(id);			
					jQuery('#detCorrPlcPaginado').val(id);
				} else {
					jQuery('#detCorrPlc').val("");	
				}
				var tab = jQuery(ui.tab);
				if (tab.is(".plc-por-demanda")) {
					setTecnologia("JSF");
					plcGeral.formSubmit('${requestScope.pStrutsAction}','#{msg["jcompany.evt.recupera.por.demanda"]}');						
				}
				
				return true;
			}
			,show: function(event, ui) {
				var detCorrPlc = jQuery('#detCorrPlc').val();
				if (detCorrPlc) {
					var detIdSubdet = /(\w+)\[(\d+)\].(\w+)/.exec(detCorrPlc);
					if (detIdSubdet) {// Detalhe[X].Subdetalhe
						var campoVazio = jQuery('input:text:enabled[name^="corpo:formulario:'+ detIdSubdet[1] +':'+ detIdSubdet[2] +':'+ detIdSubdet[3] +'"][value=""]:first', ui.panel);
						if (campoVazio.get(0)) {
							campoVazio.focus();
						} else {
							jQuery('input:text:enabled[name^="corpo:formulario:'+ detIdSubdet[1] +':'+ detIdSubdet[2] +':'+ detIdSubdet[3] +'"]:first', ui.panel).focus();
						}	
					} else {// Detalhe
						var det = tabFolderCamposFoco[ui.index].split(':0:');
						var campoVazio = jQuery('input:text[name^="'+ det[0] +'"][name$=":'+ det[1] +'"][value=""]:first');
						if (campoVazio.get(0)) {
							campoVazio.focus();
						} else {
							jQuery('input:text[name^="'+ det[0] +'"][name$=":'+ det[1] +'"]:first').focus();						
						}
					}	
				} else {
					tabFolderFocaCampo(ui.index + 1);
				}
			}
		});
	}
	/*
	 * TAB's Negadas.
	 */
	jQuery.ajax({
		url: "#{request.contextPath}/soa/plc/security/tabs?baseURI=#{request.requestURI}" 
		,cache: true
		,success: function(tabsToRemove){
			applyTabs(tabsToRemove);
		}
		,error: function(){
			applyTabs(false);
		}
	});
};

jQuery(PlcFormTabs);

</script>