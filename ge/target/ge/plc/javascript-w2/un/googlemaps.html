<html>
	<head>
		<script type="text/javascript">
		
		// Busca a chave do GoogleMaps como parâmetro da URL.
		function getGoogleMapsKey(){
			var key = String(window.location.href).match(/[\\?&]googleMapsKey=([^&#]*)/);
			return (key && key.length == 2 ? key[1] : '') || '';
		}
		// Vaz a adição do Script do GoogleMaps.
		function includeGoogleMapsApi(googleMapsKey){
			var script = document.createElement('script');
			script.src = 'http://maps.google.com/maps?file=api&amp;v=2&amp;key=' + googleMapsKey;
			document.getElementsByTagName('head')[0].appendChild(script);
		}
		
		var pesquisaEndereco = null;
		
		// Cria o GoogleMaps.
		function criaGoogleMaps(){
			
			var googleMap = null;
			
			var clientGeocoder = null;
			
			var mapWidth = '600';
			var mapHeight = '400';
			var mapClose = null;
			
			pesquisaEndereco = function(endereco, callback){
				
				if (clientGeocoder == null) {
					clientGeocoder = new GClientGeocoder();
				}
				
				clientGeocoder.getLocations(endereco, function(response){
					
					if (!response || response.Status.code != 200) {
						
						if (typeof callback == 'function') {
							callback(false);
						}
						
					} else {
						
						if (googleMap == null) {
							
							var mapa = document.getElementById('google-maps');
							mapa.style.width = mapWidth + 'px';
							mapa.style.height = mapHeight + 'px';
							
							googleMap = new GMap2(mapa);
							googleMap.addControl(new GSmallMapControl());
							
							/* go top */
							var CloseButton = function() {
								this.button = document.createElement("button");
							}
							CloseButton.prototype = new GControl();
							CloseButton.prototype.initialize = function(map) {
								this.button.innerHTML = "X";
								GEvent.addDomListener(this.button, "click", function() {
									if (mapClose) {
										mapClose();
									}
								});
								map.getContainer().appendChild(this.button);
								return this.button;
							}
							CloseButton.prototype.getDefaultPosition = function() {
								return new GControlPosition(G_ANCHOR_TOP_RIGHT, new GSize(1, 1));
							}
							
							googleMap.addControl(new CloseButton());
							
						} else {
							googleMap.clearOverlays();
						}
						
						var place = response.Placemark[0];
						var point = new GLatLng(place.Point.coordinates[1], place.Point.coordinates[0]);
						var marker = new GMarker(point);
						
						googleMap.addOverlay(marker);
						googleMap.setCenter(point, 15);
						
						marker.openInfoWindowHtml(place.address);

						if (typeof callback == 'function') {
							callback(true);
						}
					}
				});
			};
			
			if (typeof GUnload == 'function') {
				window.unload = GUnload;
			}
		}
		
		var googleMapsKey = getGoogleMapsKey();
		
		if (googleMapsKey) {
			includeGoogleMapsApi(googleMapsKey);
			criaGoogleMaps();
		}
		
		</script>
	</head>
	<body style="padding: 0px; margin: 0px;">
		<div id="google-maps"></div>
	</body>
</html>
